#include "circular_buffer.h"


void ringbuf_init(ringbuf_t *rb, uint8_t *buffer, size_t size)
{
    rb->buffer = buffer;
    rb->size = size;
    ringbuf_reset(rb);
}


void ringbuf_reset(ringbuf_t *rb)
{
    memset(rb->buffer,0,rb->size);
    rb->write = 0;
    rb->read = 0;
}


void ringbuf_write(ringbuf_t *rb, void *data, size_t bytes)
{
    memcpy(rb->buffer + rb->write,data,bytes);
    rb->write = (rb->write + bytes) % rb->size;
}


void ringbuf_read(ringbuf_t *rb, void *data, size_t bytes)
{
    memcpy(data,rb->buffer + rb->read,bytes);
    rb->read = (rb->read + bytes) % rb->size;
}


uint8_t ringbuf_full(ringbuf_t *rb)
{
    return rb->read == rb->write;
}


// ----------------------------- TEST ----------------------------- //

uint8_t test_LUT[] = {
    0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
    0x23,0x23,0x23,0x23,0x23,0x23,0x23,0x23,
    0x45,0x45,0x45,0x45,0x45,0x45,0x45,0x45,
    0x67,0x67,0x67,0x67,0x67,0x67,0x67,0x67,
    0x89,0x89,0x89,0x89,0x89,0x89,0x89,0x89,
    0xab,0xab,0xab,0xab,0xab,0xab,0xab,0xab,
    0xcd,0xcd,0xcd,0xcd,0xcd,0xcd,0xcd,0xcd,
    0xde,0xde,0xde,0xde,0xde,0xde,0xde,0xde,
    0xef,0xef,0xef,0xef,0xef,0xef,0xef,0xef,
    0xde,0xad,0xde,0xad,0xde,0xad,0xde,0xad,
    0xbe,0xef,0xbe,0xef,0xbe,0xef,0xbe,0xef,
    0xd0,0xde,0xd0,0xde,0xd0,0xde,0xd0,0xde,
    0xba,0xbe,0xba,0xbe,0xba,0xbe,0xba,0xbe,
};

int _idx = 0;

void ringbuf_get_test_samples(uint8_t *buffer, uint16_t bytes)
{
    for(int i=0;i<bytes;i++) {
        buffer[i] = test_LUT[_idx++];
        if(_idx >= sizeof(test_LUT))
            _idx = 0;
    }
}

